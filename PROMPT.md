  1. Cancelled/Pending платежи - стратегия очистки

  Есть несколько подходов, и лучше использовать комбинацию:

  Рекомендуемое решение:

  A. Таймаут платежей (Payment Expiration)
  - Установить expires_at для каждого платежа (например, 15-30 минут
   с момента создания)
  - При проверке статуса платежа автоматически помечать просроченные
   как "expired" или "cancelled"
  - Уже есть константа PAYMENT_TIMEOUT_MINUTES = 10 в config.py -
  можно использовать

  B. Кнопка "Отменить" (Cancel Button)
  - Добавить inline-кнопку "Отменить платеж" к каждому сообщению с
  инвойсом
  - При нажатии - обновить статус на "cancelled" в БД
  - Удалить/отредактировать сообщение с инвойсом

  C. Фоновая очистка (Background Cleanup)
  - Периодическая задача (например, раз в час) удаляет/архивирует
  старые pending/expired платежи
  - Можно запускать в TonTransactionsUpdater или создать отдельный
  таск

  D. Проверка перед созданием нового платежа
  - Перед созданием нового платежа проверять, есть ли у юзера
  активный pending платеж
  - Если есть - предложить отменить старый или продолжить с ним

  Что я рекомендую реализовать:

  # Приоритет 1: Кнопка отмены + таймаут
  - Добавить кнопку "Отменить" к каждому платежному сообщению
  - При создании платежа устанавливать expires_at = now +
  PAYMENT_TIMEOUT_MINUTES
  - При check_payment() проверять expires_at и помечать как expired

  # Приоритет 2: Проверка перед созданием
  - В PaymentManager.create_payment() проверить активные pending
  платежи юзера
  - Если есть - показать варианты: продолжить старый/создать
  новый/отменить старый

  # Приоритет 3: Фоновая очистка (опционально)
  - Добавить cleanup task для удаления старых (>24 часа) expired
  платежей

  Плюсы этого подхода:

  - Юзер контролирует процесс (кнопка отмены)
  - Автоматическая защита от "забытых" платежей
  - БД не захламляется
  - Нет путаницы с несколькими pending платежами